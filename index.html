<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <!-- 适配浏览器主题颜色，提升地址栏/标签栏一致性 -->
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0b0f19" media="(prefers-color-scheme: dark)">
    <!-- Apple Touch Icon 保留为你的 logo（不影响桌面浏览器 favicon 选择） -->
    <link rel="apple-touch-icon" href="/src/assets/logo-xiaole.png" />
    <!-- 默认 favicon（兼容浏览器默认请求，浅色背景用深色图标） -->
    <link rel="icon" type="image/png" href="/favicon-dark.png" />
    <!-- 主题自适配：深色主题用白色图标，浅色主题用黑色图标 -->
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-light.png" media="(prefers-color-scheme: dark)" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-light.png" media="(prefers-color-scheme: dark)" />
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-light.png" media="(prefers-color-scheme: dark)" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-dark.png" media="(prefers-color-scheme: light)" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-dark.png" media="(prefers-color-scheme: light)" />
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-dark.png" media="(prefers-color-scheme: light)" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
    <title>小乐 AI 管家 v0.8.0</title>
    <script>
        // 调试工具: 按 Ctrl+Shift+D 清除认证信息
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                console.log('🔧 清除认证信息...');
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                alert('已清除token和user，即将刷新页面');
                location.reload();
            }
        });

        // 启动时检查token有效性
        (function () {
            const token = localStorage.getItem('token');
            if (token) {
                console.log('🔍 检测到token，验证中...');
                fetch('/sessions', {
                    headers: { 'Authorization': 'Bearer ' + token }
                }).then(res => {
                    if (res.status === 401) {
                        console.warn('⚠️ Token无效，清除中...');
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        if (window.location.pathname !== '/login') {
                            window.location.href = '/login';
                        }
                    } else if (res.status === 404) {
                        // 404 可能是后端未启动或路径不存在，静默处理
                        console.warn('⚠️ API端点不存在（可能是后端未启动）');
                    } else if (res.ok) {
                        console.log('✅ Token有效');
                    }
                }).catch(err => {
                    // 网络错误或其他错误，静默处理
                    console.warn('⚠️ Token验证请求失败（可能是后端未启动）:', err.message);
                });
            } else {
                console.log('ℹ️ 未检测到token');
            }
        })();
    </script>
</head>

<body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
</body>

</html>
<body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
</body>

</html>
<body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
</body>

</html>
<body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
</body>

</html>
<body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
</body>

</html>
<body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
</body>

</html>
<body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
</body>

</html>
<body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
</body>

</html>