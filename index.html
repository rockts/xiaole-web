<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <!-- é€‚é…æµè§ˆå™¨ä¸»é¢˜é¢œè‰²ï¼Œæå‡åœ°å€æ /æ ‡ç­¾æ ä¸€è‡´æ€§ -->
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0b0f19" media="(prefers-color-scheme: dark)">
    <!-- PWA manifest -->
    <link rel="manifest" href="/manifest.json">
    <!-- Apple PWA å…ƒæ ‡ç­¾ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="å°ä¹ AI">
    <!-- Apple Touch Icon ä¿ç•™ä¸ºä½ çš„ logoï¼ˆä¸å½±å“æ¡Œé¢æµè§ˆå™¨ favicon é€‰æ‹©ï¼‰ -->
    <link rel="apple-touch-icon" href="/src/assets/logo-xiaole.png" />
    <!-- é»˜è®¤ faviconï¼ˆå…¼å®¹æµè§ˆå™¨é»˜è®¤è¯·æ±‚ï¼Œæµ…è‰²èƒŒæ™¯ç”¨æ·±è‰²å›¾æ ‡ï¼‰ -->
    <link rel="icon" type="image/png" href="/favicon-dark.png" />
    <!-- ä¸»é¢˜è‡ªé€‚é…ï¼šæ·±è‰²ä¸»é¢˜ç”¨ç™½è‰²å›¾æ ‡ï¼Œæµ…è‰²ä¸»é¢˜ç”¨é»‘è‰²å›¾æ ‡ -->
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-light.png" media="(prefers-color-scheme: dark)" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-light.png" media="(prefers-color-scheme: dark)" />
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-light.png" media="(prefers-color-scheme: dark)" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-dark.png" media="(prefers-color-scheme: light)" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-dark.png" media="(prefers-color-scheme: light)" />
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-dark.png" media="(prefers-color-scheme: light)" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
    <title>å°ä¹ AI ç®¡å®¶ v0.9.1</title>
    <script>
        // æ³¨å†Œ Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('âœ… SW registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('âŒ SW registration failed:', error);
                    });
            });
        }
    </script>
    <script>
        // è°ƒè¯•å·¥å…·: æŒ‰ Ctrl+Shift+D æ¸…é™¤è®¤è¯ä¿¡æ¯
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                console.log('ğŸ”§ æ¸…é™¤è®¤è¯ä¿¡æ¯...');
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                alert('å·²æ¸…é™¤tokenå’Œuserï¼Œå³å°†åˆ·æ–°é¡µé¢');
                location.reload();
            }
        });

        // å¯åŠ¨æ—¶æ£€æŸ¥tokenæœ‰æ•ˆæ€§
        (function () {
            const token = localStorage.getItem('token');
            if (token) {
                console.log('ğŸ” æ£€æµ‹åˆ°tokenï¼ŒéªŒè¯ä¸­...');
                fetch('/sessions', {
                    headers: { 'Authorization': 'Bearer ' + token }
                }).then(res => {
                    if (res.status === 401) {
                        console.warn('âš ï¸ Tokenæ— æ•ˆï¼Œæ¸…é™¤ä¸­...');
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        if (window.location.pathname !== '/login') {
                            window.location.href = '/login';
                        }
                    } else if (res.status === 404) {
                        // 404 å¯èƒ½æ˜¯åç«¯æœªå¯åŠ¨æˆ–è·¯å¾„ä¸å­˜åœ¨ï¼Œé™é»˜å¤„ç†
                        console.warn('âš ï¸ APIç«¯ç‚¹ä¸å­˜åœ¨ï¼ˆå¯èƒ½æ˜¯åç«¯æœªå¯åŠ¨ï¼‰');
                    } else if (res.ok) {
                        console.log('âœ… Tokenæœ‰æ•ˆ');
                    }
                }).catch(err => {
                    // ç½‘ç»œé”™è¯¯æˆ–å…¶ä»–é”™è¯¯ï¼Œé™é»˜å¤„ç†
                    console.warn('âš ï¸ TokenéªŒè¯è¯·æ±‚å¤±è´¥ï¼ˆå¯èƒ½æ˜¯åç«¯æœªå¯åŠ¨ï¼‰:', err.message);
                });
            } else {
                console.log('â„¹ï¸ æœªæ£€æµ‹åˆ°token');
            }
        })();
    </script>
</head>

<body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
</body>

</html>